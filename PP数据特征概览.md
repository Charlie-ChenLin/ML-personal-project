# PPData 数据特征概览（初步）

本文件记录对 `PP数据/` 中表格 0-16 的快速 profiling 结果（行数、日期范围、更新周期示例、数值列等），用于问题1（月度预测）数据口径讨论。

## PP价格（日度）文件位置

- 路径：`PP数据/1-华东市场PP粒市场价_法定工作日.xlsx`
- 关键字段：`日期` + `最低/最高/平均`（单位：元/吨）

## 表0（简要信息汇总）里的“备注/颜色”含义

文件：`PP数据/0-pp价格预测简要信息汇总（案例）1011.xlsx`（列：`变量名/频次/历史数据起点/备注`）

- `备注`列：用于标注变量在产业链上的位置（用于业务理解与特征分组）
  - `上游`：成本/原料/库存等（如 PDH/MTO/CTO/丙烯成本、PP石化库存）
  - `中游`：PP现货/贸易等（如 PP价格、PP进口量）
  - `下游产品`：下游加工/需求侧指标（如 塑编开工率、BOPP开工率 等）
  - `替代品`：替代路线/替代品相关指标（如 乙烯成本）
  - 空白：该表未分类（如 `期货价格`、`检修损失`）
- 表内颜色/格式（表0第18-20行给出的图例）：
  - **黄色填充**：贝叶斯联合建模已纳入的因子（在本表中：`PP价格/PP产量/排产比例/PP进口量/BOPP开工率/CTO成本/丙烯成本/PP石化库存`）
  - **红色字体**：市场认为必须纳入但数据周期太短（在本表中：`期货价格`，历史起点 2019-10）
  - **白色（默认底色）**：重要但从有效性考虑暂未纳入模型（在本表中：`塑编开工率/PP开工率/PDH成本/乙烯成本/MTO成本/检修损失`）

## 文件级概览（按文件）

| 文件 | 首个Sheet | 行数 | 日期列 | 起始日期 | 结束日期 | 去重日期数 | 更新周期(示例) | 数值列 | 最低=最高=平均占比 |
|---|---:|---:|---|---:|---:|---:|---|---|---:|
| 0-pp价格预测简要信息汇总（案例）1011.xlsx | Sheet1 | 19 |  |  |  |  | 日度; 月度 |  |  |
| 1-华东市场PP粒市场价_法定工作日.xlsx | Table1 | 1649 | 日期 | 2014-12-01 | 2021-07-15 | 1649 | 国家法定工作日 | 平均,最低,最高 | 0.000 |
| 10-MTO生产路线日度含税成本.xlsx | Table1 | 1356 | 日期 | 2016-01-04 | 2021-07-15 | 1356 | 国家法定工作日 | 平均,最低,最高 | 1.000 |
| 11-CTO生产路线日度含税成本.xlsx | Table1 | 1600 | 日期 | 2015-01-04 | 2021-07-15 | 1600 | 国家法定工作日 | 平均,最低,最高 | 1.000 |
| 12-外采丙烯生产路线日度含税成本.xlsx | Table1 | 2568 | 日期 | 2011-01-04 | 2021-07-15 | 2568 | 国家法定工作日 | 平均,最低,最高 | 1.000 |
| 13-大商所PP期货价格_短数据.xlsx | Table1 | 428 | 日期 | 2019-10-28 | 2021-07-15 | 428 | 国家法定工作日 | 平均,最低,最高 | 0.986 |
| 14-PP月度检修实际损失量.xlsx | Table1 | 42 | 日期 | 2018-01-31 | 2021-06-30 | 42 | 月末更新 | 平均,最低,最高 | 1.000 |
| 15-pp石化库存_每3个工作日更新.xlsx | pp石化库存 | 2137 | date | 2011-01-16 | 2021-07-15 | 2137 |  | inventory |  |
| 16-年度GDP.xlsx | SheetJS | 5 | 日期 | 2016-12-31 | 2020-12-31 | 5 |  | 值 |  |
| 2-中国PP月度产量.xlsx | Table1 | 90 | 日期 | 2014-01-31 | 2021-06-30 | 90 | 次月月初 | 平均,最低,最高 | 1.000 |
| 3-塑编行业周度开工率.xlsx | Table1 | 531 | 日期 | 2011-01-07 | 2021-07-15 | 531 | 国家法定工作日周四更新 | 平均,最低,最高 | 1.000 |
| 4-PP拉丝级生产比例日度数据.xlsx | Table1 | 2184 | 日期 | 2014-01-02 | 2021-07-15 | 2184 | 每日更新 | 平均,最低,最高 | 1.000 |
| 5-PP进口量月度数据_滞后一月更新.xlsx | Table1 | 137 | 日期 | 2010-01-31 | 2021-05-31 | 137 | 次月20日后第一个工作日 | 平均,最低,最高 | 1.000 |
| 6-PP注塑制品周度开工率.xlsx | Table1 | 392 | 日期 | 2014-01-03 | 2021-07-15 | 392 | 国家法定工作日周四更新 | 平均,最低,最高 | 1.000 |
| 7-BOPP月度开工率.xlsx | Table1 | 138 | 日期 | 2010-01-01 | 2021-06-01 | 138 | 月末更新 | 平均,最低,最高 | 1.000 |
| 8-PDH生产路线日度含税成本.xlsx | Table1 | 601 | 日期 | 2019-02-13 | 2021-07-15 | 601 | 国家法定工作日次工作日 | 平均,最低,最高 | 1.000 |
| 9-乙烯裂解生产路线日度含税成本.xlsx | Table1 | 1619 | 日期 | 2014-12-31 | 2021-07-15 | 1619 | 国家法定工作日次工作日 | 平均,最低,最高 | 1.000 |

## 月度表“日期”字段标记（快速检查）

- `2-中国PP月度产量.xlsx`：月末占比=1.00，月初占比=0.00（`日期`通常为月末日）
- `5-PP进口量月度数据_滞后一月更新.xlsx`：月末占比=1.00，月初占比=0.00（`日期`通常为月末日）
- `14-PP月度检修实际损失量.xlsx`：月末占比=1.00，月初占比=0.00（`日期`通常为月末日）
- `7-BOPP月度开工率.xlsx`：月末占比=0.00，月初占比=1.00（`日期`固定为每月 1 号，并另有`年/月`字段）

## 备注（用于后续“月度对齐”时的口径说明）

- 多数非价格类表里 `最低/最高/平均` 三列完全相同（占比=1.000），更像是数据源模板字段；实际建模通常直接取 `平均` 作为该日/周/月的指标值。

## 问题1：周/日频 → 月频 的降频聚合方案（已讨论）

### 已确定

- 对**日度/周度**数据降频到月度时，在 `mean/min/max` 基础上，**额外加入**：
  - `last`：该月最后一个观测值
  - `range`：该月 `max - min`
- 预测目标：**预测下月（t+1）**
- 涨跌定义：严格用 `> 0` 为涨，否则为跌（即 `y_{t+1} - y_t > 0`）
- 期货变量（`PP数据/13-大商所PP期货价格_短数据.xlsx`）：采用**纳入/不纳入两种方案**做对比
- 可复现交付：除 PDF 外，**需要 notebook + scripts 的代码结构**

### 聚合规则（落地口径）

- 月度窗口：按“自然月”（以记录的 `日期`/`date` 所在月份归属）
- 对每个变量（周/日频）在月内聚合生成 5 个特征：`mean/min/max/last/range`
- 为避免信息泄露：用于预测“下月价格”时，所有月度特征在建模前统一做 `shift(1)`（用月 t 的信息预测月 t+1）

### 待讨论（尚未定）

- “每张表用哪一列作为序列值”：我们已对“含 `最低/最高/平均` 的表”确定了月度聚合口径，但对“没有这三列的表”需要单独定义。

## 问题1：聚合取值口径（已讨论并确定一部分）

### 已确定：原表含 `最低/最高/平均` 三列时

对日度/周度数据降频到月度时：

- 新特征 `mean`：取原表 `平均` 列在月内的均值
- 新特征 `min`：取原表 `最低` 列在月内的最小值
- 新特征 `max`：取原表 `最高` 列在月内的最大值
- 新特征 `range`：按 `max - min` 计算
- 新特征 `last`：取该月最后一个观测日的 `平均`

### 已确定：没有 `最低/最高/平均` 三列，但存在“数值列”的表

规则：统一将“该数值列”视为序列值，对其在月内计算 `mean/min/max/last/range`（`range=max-min`，`last`为当月最后一个观测值）。

目前在 `PP数据/` 中发现的例外（无 `最低/最高/平均`，但有可用数值列）：

- `PP数据/15-pp石化库存_每3个工作日更新.xlsx`（sheet=`pp石化库存`）：数值列 `inventory`
- `PP数据/16-年度GDP.xlsx`（sheet=`SheetJS`）：数值列 `值`（`单位`列被读取为数值是因为空值/格式原因，实际含义是单位）
