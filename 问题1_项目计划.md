# 问题1：PP拉丝价格月度预测（项目计划）

本计划对应 `2025年个人PJ.docx` 的问题1：基于 `PP数据/` 的历史相关数据，对 **PP价格** 做 **月度预测** 并输出 **未来涨跌方向**。

## 0. 当前已确认的口径（讨论结论）

- 预测目标：预测下月（t+1）；在建模数据中，每行代表“被预测的月份 t”
- 涨跌方向（问题1）：严格用 `(y_t - y_{t-1}) > 0` 为涨，否则为跌
- 涨跌强度（题目第2问）：基于月度涨跌幅 `r_t=(y_t-y_{t-1})/y_{t-1}` 分档（默认：`|r|<=0.5%` 为 `flat`，`|r|>=5%` 为 `big_*`；其余为 `small_*`），并输出各档概率
- 周/日频 → 月频降频聚合：
  - 若原表含 `最低/最高/平均`：`mean=avg列月均`，`min=min列月最小`，`max=max列月最大`，`last=月末最后观测的avg`，`range=max-min`
  - 若原表无 `最低/最高/平均` 但有数值列：统一以该数值列为序列值，同样生成 `mean/min/max/last/range`
- 期货变量（`PP数据/13-大商所PP期货价格_短数据.xlsx`）：做“纳入/不纳入”两套方案对比
- 可复现交付：除 PDF 外，需要 notebook + scripts 代码结构

## 1. 数据与变量清单（PP数据/）

- 预测目标（PP价格，日度）：`PP数据/1-华东市场PP粒市场价_法定工作日.xlsx`
- 主要相关因子（表2-16）：产量/进口/下游开工、成本路线、库存、检修损失、期货等
- 汇总表（表0）：`PP数据/0-pp价格预测简要信息汇总（案例）1011.xlsx`（含产业链备注与“颜色图例”）

## 2. 目标变量（月度）构建

从 PP 日度价格构建月度价格（需在报告中明确口径）：

- 方案A（默认建议）：**月均价**（当月日度 `平均` 的均值）
- 方案B：**月末价**（当月最后一个交易日的日度 `平均`）

两种口径都可做；建议先用月均价作为主结果，再附录对比月末价的稳健性。

## 3. 特征工程与数据预处理

1) **统一月度索引**：以“自然月”作为主键（`YYYY-MM`）  
2) **降频聚合**：对日度/周度/不规则更新数据，按已确认规则生成 `mean/min/max/last/range`  
3) **时序对齐防泄露**：用月 t-1 的信息预测月 t（整体对特征做 `shift(1)`）  
4) **缺失值处理**：按训练集统计量做数值型填补（如 median），并记录缺失指示（MissingIndicator）  
5) **描述性统计（必须体现）**：
   - 价格趋势与波动、季节性探索
   - 关键因子与价格的相关性（注意滞后）
   - 测试窗口（2021-01~2021-07）的特征/目标分布对比

## 4. 建模方案（问题1）

### 4.1 Baseline（必须有）

- Naive：`ŷ_t = y_{t-1}`
- Seasonal Naive：`ŷ_t = y_{t-12}`（如能覆盖）

### 4.2 回归模型（预测价格）

至少比较 2-3 个模型（并在报告给出参数设置或设置方法）：

- 线性回归（Ridge/Lasso/ElasticNet，含标准化）
- 随机森林回归（非线性、可解释性较强）
- 梯度提升回归（GBR；作为非线性对照）

### 4.3 涨跌方向输出

- 由回归结果派生：`direction_pred = (ŷ_t - y_{t-1} > 0)`
- 并计算 Accuracy / Precision / Recall（按 docx 提示）

### 4.4 涨跌强度与幅度输出（对应题目第2问）

- 强度标签：将 `r̂_t=(ŷ_t-y_{t-1})/y_{t-1}` 映射到 `big_up/small_up/flat/small_down/big_down`
- 概率输出：训练多分类模型（如多项Logistic、RF分类等）输出各档 `predict_proba`，作为“出现相关涨跌幅度的概率”
- 数值幅度输出：用回归模型的 `ŷ_t` 给出点预测，再换算为 `r̂_t`（涨跌幅度的数值预测）

## 5. 验证设计（时间序列）

- 固定连续窗口测试（docx 提示例）：`2021-01` ~ `2021-07`
- 训练集：严格使用测试窗口之前的月份
- 可选增强：滚动/扩展窗口验证（提升可信度，但不强制）

## 6. 两套特征集对比（是否纳入期货）

- Long sample（不纳入期货）：覆盖更长历史
- With futures（纳入期货）：样本短但可能信息更强；可选择：
  - Restrict：仅使用期货特征存在的月份（更贴近“真实可用”）
  - Impute：对缺失月份做填补（更偏工程化）

## 7. 结果呈现与报告结构（≤35页）

- 数据说明与预处理（含降频规则、缺失处理、描述统计）
- 模型与参数设置（或调参方法）
- 实验设计（时间序列划分）
- 结果对比（表格 + 关键月份误差分析）
- 总结（不足与展望）
- 附录：代码与补充图表

## 8. 可复现代码结构（已落地）

- 使用说明：`README.md`
- 数据集生成：`scripts/build_q1_dataset.py`
- 训练评估：`scripts/run_q1_models.py`
- Notebook 工作台：`notebooks/Q1_EDA_建模.ipynb`
